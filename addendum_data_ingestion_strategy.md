# Addendum: 데이터 수집 전략 및 아키텍처 보강안

## 개요 (Overview)

본 문서는 GraphRAG 기반 보험 분석 서비스 구축 프로젝트의 초기 데이터 수집 단계에서 발생할 수 있는 법적/기술적 리스크를 최소화하고, 운영 효율성을 극대화하기 위한 **"메타데이터 우선 수집 및 Human-in-the-Loop 큐레이션"** 전략에 대해 기술한다.

기존의 무차별적인 대량 크롤링 및 학습 방식 대신, 관리자의 개입을 통한 선별적 학습 파이프라인을 도입하여 안정적이고 지속 가능한 시스템 기반을 마련하는 것을 목표로 한다.

## 핵심 전략: Human-in-the-Loop 기반 선별적 수집

### 전략적 배경 및 필요성

1.  **법적 및 윤리적 리스크 회피:**
    * 보험사 웹사이트의 대량 파일 다운로드로 인한 서버 부하(DDoS 오인 가능성) 및 `robots.txt` 준수 이슈를 사전 차단한다.
    * 단순 목록(메타데이터) 접근은 일반적인 웹 브라우징 범위 내에 있어 법적 분쟁 소지가 낮다.
    * 최종적인 파일 다운로드가 관리자의 명시적인 행위(클릭)에 의해 이루어지므로, "의도된 무단 수집"이 아님을 방어할 수 있다.

2.  **학습 비용 및 품질 최적화:**
    * 중복 파일, 단순 안내문, 구버전 약관 등 학습 가치가 낮은 데이터를 사전에 필터링하여 불필요한 컴퓨팅 리소스(GraphRAG 인덱싱 비용) 낭비를 막는다.
    * 영업 현장에서 시급히 필요한 핵심 상품 약관부터 우선순위를 두어 학습시키는 전략적 운영이 가능하다.

### 기술 아키텍처 (Technical Architecture)

본 전략을 구현하기 위해 시스템을 다음 4가지 핵심 컴포넌트로 분리하여 구성한다.



#### 1. 경량 메타데이터 크롤러 (Lightweight Discovery Bot)
* **기능:** 타겟 보험사 공시실 웹페이지를 주기적으로 순회하며 게시물 목록의 HTML만 파싱한다. **절대 첨부파일(PDF)을 직접 다운로드하지 않는다.**
* **수집 데이터:** 보험사명, 카테고리(상품종류), 약관명, 게시일, 파일명, **원본 다운로드 링크 URL**.
* **기술 스택 예시:** Python Scrapy, Node.js Puppeteer (동적 페이지 대응).

#### 2. 중앙 메타데이터 데이터베이스 (Metadata DB)
* **기능:** 수집된 약관 목록 원장과 각 파일의 현재 상태(Lifecycle Status)를 중앙에서 관리한다.
* **핵심 스키마 (Status 필드):**
    * `DISCOVERED`: 크롤러가 새로 발견함 (초기 상태)
    * `QUEUED`: 관리자가 학습을 지시하여 다운로드 대기열에 등록됨
    * `DOWNLOADING`: 파일 다운로드 진행 중
    * `PROCESSING`: GraphRAG 파이프라인에서 학습 진행 중
    * `COMPLETED`: 학습 완료 및 서비스 반영됨
    * `FAILED`: 오류 발생 (재시도 필요)
    * `IGNORED`: 관리자가 학습 대상에서 제외함

#### 3. 관리자 큐레이션 대시보드 (Admin Curation UI)
* **기능:** 관계자(현업팀, 운영팀)가 메타데이터 DB의 내용을 조회하고 학습 대상을 선별하는 웹 인터페이스.
* **주요 액션:**
    * 다양한 조건(보험사, 기간, 키워드)으로 필터링 및 검색.
    * 학습 상태(`DISCOVERED`, `COMPLETED` 등)를 시각적으로 확인.
    * **[학습 시작] 버튼:** 클릭 시 해당 파일의 상태를 `QUEUED`로 변경하고 온디맨드 워커를 트리거한다.

#### 4. 온디맨드 다운로더 & 인제스션 워커 (On-demand Worker)
* **기능:** 관리자의 요청이 있을 때만 백그라운드에서 실행되는 작업 프로세스.
* **실행 흐름:**
    1.  `QUEUED` 상태의 작업을 할당받음.
    2.  메타데이터에 저장된 `다운로드 링크 URL`로 실제 보험사 서버에 접근하여 파일을 다운로드.
    3.  내부 스토리지(S3 등)에 안전하게 저장.
    4.  GraphRAG 학습 파이프라인 호출.
    5.  작업 결과에 따라 DB 상태 업데이트 (`COMPLETED` or `FAILED`).
* **기술 스택 예시:** Celery, AWS SQS + Lambda.

## 운영 시나리오 및 기대 효과

1.  **매일 아침:** 크롤러봇이 밤새 새로 올라온 약관 목록을 가져와 DB에 `DISCOVERED` 상태로 쌓아둔다.
2.  **오전 업무 시간:** 운영 담당자가 대시보드에 접속하여 "어제 올라온 A생명의 신규 암보험 약관"을 발견한다. 학습 가치가 있다고 판단하여 **[학습 시작]** 버튼을 클릭한다.
3.  **백그라운드:** 워커가 즉시 해당 파일을 받아와 학습을 시작한다. 다른 불필요한 파일들은 서버 용량이나 비용을 축내지 않고 DB에 목록으로만 남아있다.
4.  **오후:** 학습이 완료되면 대시보드 상태가 초록색(`COMPLETED`)으로 바뀌고, 영업 일선에서 챗봇을 통해 해당 약관 내용을 조회할 수 있게 된다.

## 결론

이 아키텍처는 초기 구축 공수가 다소 증가하지만, 장기적인 서비스 운영의 안정성, 법적 리스크 관리, 그리고 비용 효율성 측면에서 필수적인 투자이다. 기술적으로 성숙하고 현명한 접근 방식임을 확인하며, 이를 프로젝트의 표준 데이터 수집 절차로 채택한다.